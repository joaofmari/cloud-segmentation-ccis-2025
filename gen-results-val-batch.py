import os
import time, datetime
import argparse
import shutil

parser = argparse.ArgumentParser()

parser.add_argument('--main_path', type=str, default='exp_38cloud', help='Main path.')

args = parser.parse_args()
# print(args.main_path)
# print(os.listdir(args.main_path))

# List experiments in the Main path.
exp_path_list = [path for path in os.listdir(args.main_path) if os.path.isdir(os.path.join(args.main_path, path))]
exp_path_list.sort()
print(exp_path_list)

# Experiment counter
ec = 0

for exp_path in exp_path_list:
    print(exp_path[:13])

    # Avoid folders generated by the Matlab script.
    if exp_path[:13] != 'entire_masks_':
        cmd_str = f'nohup python gen-results-val.py --main_path {args.main_path} --exp {exp_path}'
    else:
        continue
                    
    ec = ec + 1

    print(cmd_str)
    os.system(cmd_str)

if os.path.exists('./nohup.out'):
    suffix = ''
    while True:
        if os.path.exists(os.path.join(args.main_path, 'nohup' + suffix + '.out')):
            suffix += '_'
        else:
            break
    shutil.move('./nohup.out', os.path.join(args.main_path, 'nohup' + suffix + '.out'))

print('\nDone! (gen-results-val-batch)')